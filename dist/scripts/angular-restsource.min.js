/**! 
 * angular-restsource v0.3.0
 * Copyright (c) 2013 Ares Project Management LLC <code@prismondemand.com>
 */
!function(){"use strict";var a=function(b,c,d,e,f,g,h){function i(a){return angular.extend({},m.httpConfig,a)}function j(a){return m.responseInterceptors.reduce(function(a,b){try{return angular.isFunction(b.request)?b.request(a):a}catch(c){return g.error(c),a}},a)}function k(a){var b=m.responseInterceptors.reduce(function(a,b){return angular.isFunction(b)?b(a):angular.isFunction(b.response)?a.then(b.response):(g.warn("**** invalid response interceptor"),a)},a);return b.success=function(b){return a.then(function(a){var c=a.data||{};b(c.body,a.status,a.headers,a.config)}),n},b.error=function(b){return a.then(null,function(a){var c=a.data||{};b(c.error||{},a.status,a.headers,a.config)}),n},b}function l(a,b){if(!a)return a;var c=a.match(/{{[\w_\.]+}}/g);if(!c)return a;var d=angular.extend({},m.pathParams,b);return c.reduce(function(a,b){var c=b.replace(/[\{\}]+/g,""),e=f(c)(d);return a.replace(b,angular.isFunction(e)?e():e)},a)}var m=angular.extend({idField:"id",responseInterceptors:[],httpConfig:{},verbs:{},pathParams:{}},c),n=this;Object.defineProperty(this,"rootUrl",{get:function(){return b}}),Object.defineProperty(this,"options",{get:function(){return m}}),angular.forEach(m.verbs,function(a,c){n[c]=function(){var c=i(a.apply(n,arguments));return c.url=l(b+c.url,c.pathParams),h.extend(k(d(j(c))))}}),this.save=function(a,b){return a[m.idField]?n.update(a,i(b)):n.create(a,i(b))},this.clone=function(c){return new a(b,angular.extend({},m,c),d,e,f,g,h)}};angular.module("angular-restsource",["angular-restsource.promise-extensions"]).config(["$provide",function(b){b.provider("restsource",function(){var c=this,d={idField:"id",httpConfig:{},verbs:{},responseInterceptors:[],pathParams:{}},e=!0,f={page:1,perPage:25};this.idField=function(a){return d.idField=a,c},this.httpConfig=function(a){return d.httpConfig=a,c},this.defaultListLimits=function(a,b){return f={page:a,perPage:b},c},this.useBodyResponseInterceptor=function(a){return e=a,c},this.addResponseInterceptor=function(a){return d.responseInterceptors.push(a),c},this.pathParams=function(a){return d.pathParams=a,c},this.provide=function(a,c){return b.provider(a,function(){var b=this,g=angular.copy(d),h=angular.copy(e),i=angular.copy(f);this.idField=function(a){return g.idField=a,b},this.httpConfig=function(a){return g.httpConfig=a,b},this.defaultListLimits=function(a,c){return i={page:a,perPage:c},b},this.useBodyResponseInterceptor=function(a){return h=a,b},this.addResponseInterceptor=function(a){return g.responseInterceptors.push(a),b},this.pathParams=function(a){return g.pathParams=a,b},this.verb=function(c,d){Array.prototype.slice.call(arguments);if(!angular.isFunction(d))throw"Invalid argument: invalid request fn for `"+a+":"+c+"`";return g.verbs[c]=d,b},this.verb("create",function(a,b){return angular.extend({method:"POST",url:"",pathParams:a,data:a},b)}),this.verb("read",function(a,b){return angular.extend({method:"GET",url:"/{{id}}",pathParams:{id:a}},b)}),this.verb("update",function(a,b){return angular.extend({method:"PUT",url:"/{{id}}",pathParams:a,data:a},b)}),this.verb("list",function(a,b,c){return angular.extend({method:"GET",url:"",params:{page:a||i.page,perPage:b||i.perPage}},c)}),this.verb("delete",function(a,b){return angular.extend({method:"DELETE",url:"/{{id}}",pathParams:angular.isObject(a)?a:{id:a},data:angular.isObject(a)?a:void 0},b)}),this.$get=function(a,b){var d=angular.copy(g);return h&&d.responseInterceptors.unshift("bodyResponseInterceptor"),d.responseInterceptors=d.responseInterceptors.map(function(b){return angular.isString(b)?a.get(b):angular.isFunction(b)||angular.isArray(b)?a.invoke(b):b}),(angular.isString(d.pathParams)||angular.isFunction(d.pathParams)||angular.isArray(d.pathParams))&&(d.pathParams=angular.isString(d.pathParams)?a.get(d.pathParams):a.invoke(d.pathParams)),b(c,d)},this.$get.$inject=["$injector","restsource"]})},this.$get=function(b,c,d,e,f){return function(g,h){return new a(g,h,b,c,d,e,f)}},this.$get.$inject=["$http","$q","$parse","$log","PromiseExtensions"]}),b.factory("bodyResponseInterceptor",["$q",function(a){return{response:function(b){var c=b.data||{};return c.error||void 0===c.body?a.reject(b):c.body}}}])}])}(),function(a){"use strict";function b(a){return a&&a.window===a}var c=1,d={createIndex:function(a,b,c){return a.reduce(function(a,d){var e=angular.isFunction(b)?b(d):d[b];return a[e]=angular.isFunction(c)?c(d):d,a},{})},toArray:function(a){for(var b=new Array(a.length),c=0;c<b.length;++c)b[c]=a[c];return b},isArrayLike:function(a){if(null===a||void 0===a||b(a))return!1;var d="length"in Object(a)&&a.length;return a.nodeType===c&&d?!0:angular.isString(a)||angular.isArray(a)||0===d||"number"==typeof d&&d>0&&d-1 in a}},e=function(a,b){function c(a){return Object.keys(h).reduce(function(b,c){var d=h[c],e=a[c],f=d[e];return f?!0:(d[e]=a,b)},!1)}var e=this,f=[],g=b||"id",h={};h[g]={},["forEach","map","filter","reduce","sort","indexOf"].forEach(function(a){e[a]=function(){return f[a].apply(f,arguments)}}),Object.defineProperty(this,"length",{get:function(){return f.length},set:function(a){var b=f.length-a;0>=b||f.splice(a,b).forEach(e.remove)}}),this.read=function(a){return h[g]?h[g][a]:null},this.get=function(a){return f[a]},this.save=function(a){if(arguments.length>1)return e.save(d.toArray(arguments));if(angular.isArray(a))return a.map(function(a){return e.save(a)});var b=a[g];if(null===b||void 0===b)throw"ArrayCache::save: record has no primary id";var h=e.read(b);return c(a),h?(angular.extend(h,a),h):(f.push(a),a)},this.push=this.save,this.remove=function(a){if(angular.isArray(a))return a.map(e.remove);var b=e.read(a)||e.read(a[g]);if(!b)return void 0;angular.forEach(h,function(a,c){var d=b[c];delete a[d]});var c=f.indexOf(b);return c>-1&&f.splice(c,1),b},this.index=function(a,b){var c=a||"id",e=h[c];return e||(h[c]=d.createIndex(f,c,b)),h[c]},this.toArray=function(){return[].concat(f)},angular.isArray(a)&&this.save(a)};a.Restsource={ArrayUtils:d,ArrayCache:e}}(window),function(){"use strict";function a(a){return angular.isArray(a)?"array":angular.isObject(a)?"object":"primitive"}var b=Restsource.ArrayUtils,c=function(a){if(!a||!angular.isFunction(a.then))throw"Invalid argument: not a promise";if(a instanceof c)return a;var d,e=this,f={then:a.then,"catch":a["catch"],"finally":a["finally"],success:a.success,error:a.error},g=!1;angular.extend(this,a),a.then(function(a){d=a})["finally"](function(){g=!0}),Object.defineProperty(this,"$resolved",{get:function(){return d}}),Object.defineProperty(this,"$isResolved",{get:function(){return g}}),this.then=function(){return new c(f.then.apply(e,arguments))},this["catch"]=function(){return new c(f["catch"].apply(e,arguments))},this["finally"]=function(){return new c(f["finally"].apply(e,arguments))},this.spread=function(a,b){return e.then(function(b){return a.apply(this,b)},b)},this.get=function(a){return e.then(function(b){return b[a]})},this.invoke=function(a){var c=b.toArray(arguments);return c.shift(),e.then(function(b){var d=b[a];if(!angular.isFunction(d))throw"PromiseExtensions - Invalid argument: methodName does not reference a method";return d.apply(b,c)})},this.map=function(){var a=["map"].concat(b.toArray(arguments));return e.invoke.apply(e,a)},this.filter=function(){var a=["filter"].concat(b.toArray(arguments));return e.invoke.apply(e,a)},this.reduce=function(){var a=["reduce"].concat(b.toArray(arguments));return e.invoke.apply(e,a)},this.sort=function(){var a=["sort"].concat(b.toArray(arguments));return e.invoke.apply(e,a)},this.indexOf=function(){var a=["indexOf"].concat(b.toArray(arguments));return e.invoke.apply(e,a)},this.index=function(a,c){return b.createIndex(e,a,c)},this.resolveTo=function(a){return c.resolveTo(e,a)}};c.extend=function(a){return new c(a)},c.index=function(a,b,d){return c.extend(a).index(b,d)},c.map=function(a,b){return c.extend(a).map(b)},c.spread=function(a,b,d){return c.extend(a).spread(b,d)},c.resolveTo=function(b,d){var e=a(d);if("primitive"===e)throw"Invalid argument: resolved must be an object";var f=c.extend(b).then(function(b){var f=a(b);switch([e,f].join("<")){case"object<object":angular.merge(d,b);break;case"object<array":b.forEach(function(a,b){d[b]=a});break;case"object<primitive":d.toString=function(){return b?b.toString():b},d.valueOf=function(){return b};break;case"array<array":b.forEach(function(a){d.push(a)});break;case"array<object":case"array<primitive":d.push(b);break;default:return c.reject("Failed to merge result to object instance")}return d});return Object.defineProperties(d,{$promise:{get:function(){return f}}}),d},c.merge=function(a,c){return b.isArrayLike(c)&&b.isArrayLike(a)?(a.push.apply(a,c),a):angular.isObject(c)&&angular.isObject(a)?(angular.extend(a,c),a):c},c.isResolvedTo=function(a){return["$promise"].every(function(b){return b in a})},angular.module("angular-restsource.promise-extensions",[]).factory("PromiseExtensions",["$q",function(a){return angular.forEach(["defer","reject"],function(b){c[b]=a[b]}),c.all=function(b){return c.extend(a.all(b))},c.when=function(){return c.extend(a.when.apply(a,arguments))},c.reject=function(b){return c.extend(a.reject(b))},c}]).run(["PromiseExtensions",function(){}])}();