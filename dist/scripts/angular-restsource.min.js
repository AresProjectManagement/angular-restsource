/**! 
 * angular-restsource v0.3.0
 * Copyright (c) 2013 Ares Project Management LLC <code@prismondemand.com>
 */
!function(){"use strict";var a=function(b,c,d,e,f,g,h){function i(a){return angular.extend({},m.httpConfig,a)}function j(a){return m.responseInterceptors.reduce(function(a,b){try{return angular.isFunction(b.request)?b.request(a):a}catch(c){return g.error(c),a}},a)}function k(a){var b=m.responseInterceptors.reduce(function(a,b){return angular.isFunction(b)?b(a):angular.isFunction(b.response)?a.then(b.response):(g.warn("**** invalid response interceptor"),a)},a);return b.success=function(b){return a.then(function(a){var c=a.data||{};b(c.body,a.status,a.headers,a.config)}),n},b.error=function(b){return a.then(null,function(a){var c=a.data||{};b(c.error||{},a.status,a.headers,a.config)}),n},b}function l(a,b){if(!a)return a;var c=a.match(/{{[\w_\.]+}}/g);if(!c)return a;var d=angular.extend({},m.pathParams,b);return c.reduce(function(a,b){var c=b.replace(/[\{\}]+/g,""),e=f(c)(d);return a.replace(b,angular.isFunction(e)?e():e)},a)}var m=angular.extend({idField:"id",responseInterceptors:[],httpConfig:{},verbs:{},pathParams:{}},c),n=this;Object.defineProperty(this,"rootUrl",{get:function(){return b}}),Object.defineProperty(this,"options",{get:function(){return m}}),angular.forEach(m.verbs,function(a,c){n[c]=function(){var c=i(a.apply(n,arguments));return c.url=l(b+c.url,c.pathParams),h.extend(k(d(j(c))))}}),this.save=function(a,b){return a[m.idField]?n.update(a,i(b)):n.create(a,i(b))},this.clone=function(c){return new a(b,angular.extend({},m,c),d,e,f,g,h)}};angular.module("angular-restsource",["angular-restsource.promise-extensions"]).config(["$provide",function(b){b.provider("restsource",function(){var c=this,d={idField:"id",httpConfig:{},verbs:{},responseInterceptors:[],pathParams:{}},e=!0,f={page:1,perPage:25};this.idField=function(a){return d.idField=a,c},this.httpConfig=function(a){return d.httpConfig=a,c},this.defaultListLimits=function(a,b){return f={page:a,perPage:b},c},this.useBodyResponseInterceptor=function(a){return e=a,c},this.addResponseInterceptor=function(a){return d.responseInterceptors.push(a),c},this.pathParams=function(a){return d.pathParams=a,c},this.provide=function(a,c){return b.provider(a,function(){var b=this,g=angular.copy(d),h=angular.copy(e),i=angular.copy(f);this.idField=function(a){return g.idField=a,b},this.httpConfig=function(a){return g.httpConfig=a,b},this.defaultListLimits=function(a,c){return i={page:a,perPage:c},b},this.useBodyResponseInterceptor=function(a){return h=a,b},this.addResponseInterceptor=function(a){return g.responseInterceptors.push(a),b},this.pathParams=function(a){return g.pathParams=a,b},this.verb=function(c,d){Array.prototype.slice.call(arguments);if(!angular.isFunction(d))throw"Invalid argument: invalid request fn for `"+a+":"+c+"`";return g.verbs[c]=d,b},this.verb("create",function(a,b){return angular.extend({method:"POST",url:"",pathParams:a,data:a},b)}),this.verb("read",function(a,b){return angular.extend({method:"GET",url:"/{{id}}",pathParams:{id:a}},b)}),this.verb("update",function(a,b){return angular.extend({method:"PUT",url:"/{{id}}",pathParams:a,data:a},b)}),this.verb("list",function(a,b,c){return angular.extend({method:"GET",url:"",params:{page:a||i.page,perPage:b||i.perPage}},c)}),this.verb("delete",function(a,b){return angular.extend({method:"DELETE",url:"/{{id}}",pathParams:angular.isObject(a)?a:{id:a},data:angular.isObject(a)?a:void 0},b)}),this.$get=function(a,b){h&&g.responseInterceptors.unshift("bodyResponseInterceptor");var d=[];return angular.forEach(g.responseInterceptors,function(b){d.push(angular.isString(b)?a.get(b):a.invoke(b))}),g.responseInterceptors=d,(angular.isString(g.pathParams)||angular.isFunction(g.pathParams)||angular.isArray(g.pathParams))&&(g.pathParams=angular.isString(g.pathParams)?a.get(g.pathParams):a.invoke(g.pathParams)),b(c,g)},this.$get.$inject=["$injector","restsource"]})},this.$get=function(b,c,d,e,f){return function(g,h){return new a(g,h,b,c,d,e,f)}},this.$get.$inject=["$http","$q","$parse","$log","PromiseExtensions"]}),b.factory("bodyResponseInterceptor",["$q",function(a){return{response:function(b){var c=b.data||{};return c.error||void 0===c.body?a.reject(b):c.body}}}])}])}(),function(){"use strict";function a(a){return void 0!==a&&null!==a}function b(a){return"boolean"==typeof a}var c=function(a){if(!a||!angular.isFunction(a.then))throw"Invalid argument: not a promise";if(a instanceof c)return a;var b=this,d={then:a.then,"catch":a["catch"],"finally":a["finally"],success:a.success,error:a.error};angular.extend(this,a),this.then=function(){return new c(d.then.apply(b,arguments))},this["catch"]=function(){return new c(d["catch"].apply(b,arguments))},this["finally"]=function(){return new c(d["finally"].apply(b,arguments))},this.spread=function(a,c){return b.then(function(b){return a.apply(this,b)},c)},this.get=function(a){return b.then(function(b){return b[a]})},this.map=function(a){return b.then(function(b){return b.map(a)})},this.filter=function(a){return b.then(function(b){return b.filter(a)})},this.reduce=function(a,c){return b.then(function(b){return b.reduce(a,c)})},this.sort=function(a){return b.then(function(b){return b.sort(a),b})},this.index=function(a,c){return b.reduce(function(b,d){var e=angular.isFunction(a)?a(d):d[a];return b[e]=angular.isFunction(c)?c(d):d,b},{})},this.indexOf=function(a){return b.then(function(b){return b.indexOf(a)})},this.resolveTo=function(a,d,e){return angular.isFunction(e)?e(b,a,d):angular.isArray(a)?c.resolveToArray(b,a,d):c.resolveTo(b,a,d)}};c.extend=function(a){return new c(a)},c.index=function(a,b,d){return c.extend(a).index(b,d)},c.map=function(a,b){return c.extend(a).map(b)},c.spread=function(a,b,d){return c.extend(a).spread(b,d)},c.resolveTo=function(d,e,f){if(angular.isString(e)||angular.isNumber(e)||b(e))throw"Invalid argument: cannot resolve to primitive";var g,h,i=!1,j={valueOf:e.valueOf,toString:e.toString,then:d.then,"catch":d["catch"],"finally":d["finally"]},k=angular.isFunction(f)?f:c.merge,l=d.then(function(a){return i=!0,(angular.isString(a)||angular.isNumber(a)||b(a))&&(g=a),k(e,a)});return d["catch"](function(a){h=a,i=!0}),Object.defineProperty(e,"$promise",{get:function(){return l}}),Object.defineProperty(e,"$primitive",{get:function(){return g}}),Object.defineProperty(e,"$rejection",{get:function(){return h}}),Object.defineProperty(e,"$isResolved",{get:function(){return i}}),e.valueOf=function(){return a(g)?g:j.valueOf.call(e)},e.toString=function(){return a(g)?g.toString():j.toString.call(e)},e.$then=function(){return j.then.apply(l,arguments)},e.$catch=function(){return j["catch"].apply(l,arguments)},e.$finally=function(){return j["finally"].apply(l,arguments)},e.then=e.$then,e["catch"]=e.$catch,e["finally"]=e.$finally,e.$get=function(a){return e.$then(function(b){return b[a]})},e},c.merge=function(a,b){return angular.isArray(b)&&angular.isArray(a)?(b.forEach(function(b){a.push(b)}),a):angular.isObject(b)&&angular.isObject(a)?(angular.extend(a,b),a):b},c.resolveToArray=function(a,b,d){return c.resolveTo(a,b,d),Object.defineProperty(b,"$length",{get:function(){return b.$then(function(a){return a.length})}}),b.$spread=function(a,c){return b.$then(function(b){return a.apply(this,b)},c)},b.$map=function(a){return b.$then(function(b){return b.map(a)})},b.$filter=function(a){return b.$then(function(b){return b.filter(a)})},b.$reduce=function(a,c){return b.$then(function(b){return b.reduce(a,c)})},b.$forEach=function(a){return b.$then(function(b){b.forEach(a)})},b.$sort=function(a){return b.$then(function(b){b.sort(a)})},b.$indexOf=function(a){return b.$then(function(b){return b.indexOf(a)})},b.$index=function(a,c){return b.$reduce(function(b,d){var e=angular.isFunction(a)?a(d):d[a];return b[e]=angular.isFunction(c)?c(d):d,b},{})},b},c.resolveToStore=function(a,b,d){function e(a){return b.$indexes().then(function(b){var c=!1;return angular.forEach(b,function(b,d){var e=a[d],f=b[e];f?c=!0:b[e]=a}),c})}c.resolveToArray(a,b,d);var f={$index:b.$index},g={id:f.$index("id")};return b.$index=function(a,b){var c=a||"id",d=g[c];return d||(g[c]=f.$index(c,b)),g[c]},b.$indexes=function(){return c.all(g)},b.$read=function(a){return g.id.then(function(b){return b[a]})},b.$update=function(a){return g.id.then(function(b){var d=b[a.id];return d?(angular.extend(d,a),d):c.reject("record not found")})},b.$save=function(a){return g.id.then(function(c){return c[a.id]?b.$update(a):b.$push(a)})},b.$saveAll=function(a){return c.all(a.map(b.$save))},b.$push=function(a){return e(a).then(function(){return b.push(a),a})},b.$pushAll=function(a){return c.all(a.map(b.$push))},b.$unshift=function(a){return e(a).then(function(){return b.unshift(a),a})},b.$insert=function(a,c){return e(c).then(function(){return b.insert(a,c),c})},b.$remove=function(a){return b.$indexes().then(function(c){var d=c.id[a]||c.id[a.id];if(!d)return void 0;angular.forEach(c,function(a,b){var c=d[b];delete a[c]});var e=b.indexOf(d);return e>-1&&b.splice(e,1),d})},b.$removeAll=function(a){return c.all(a.map(b.$remove))},b.$clear=function(){return b.$indexes().then(function(a){return angular.forEach(a,function(a){Object.keys(a).forEach(function(b){delete a[b]})}),b.length=0,b})},b},angular.module("angular-restsource.promise-extensions",[]).factory("PromiseExtensions",["$q",function(a){return angular.forEach(["defer","reject"],function(b){c[b]=a[b]}),c.all=function(b){return c.extend(a.all(b))},c.when=function(){return c.extend(a.when.apply(a,arguments))},c.reject=function(b){return c.extend(a.reject(b))},c}]).run(["PromiseExtensions",function(){}])}();